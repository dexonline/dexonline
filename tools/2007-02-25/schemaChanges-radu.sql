-- constraints
delete from constraints;

-- Singular (nouns)
insert into constraints set constr_id = 'S', infl_id = 1;
insert into constraints set constr_id = 'S', infl_id = 2;
insert into constraints set constr_id = 'S', infl_id = 5;
insert into constraints set constr_id = 'S', infl_id = 6;
insert into constraints set constr_id = 'S', infl_id = 9;
insert into constraints set constr_id = 'S', infl_id = 10;
insert into constraints set constr_id = 'S', infl_id = 13;
insert into constraints set constr_id = 'S', infl_id = 14;
insert into constraints set constr_id = 'S', infl_id = 17;
insert into constraints set constr_id = 'S', infl_id = 18;
insert into constraints set constr_id = 'S', infl_id = 21;
insert into constraints set constr_id = 'S', infl_id = 22;

-- Singular (adjectives)
insert into constraints set constr_id = 'S', infl_id = 25;
insert into constraints set constr_id = 'S', infl_id = 26;
insert into constraints set constr_id = 'S', infl_id = 29;
insert into constraints set constr_id = 'S', infl_id = 30;
insert into constraints set constr_id = 'S', infl_id = 33;
insert into constraints set constr_id = 'S', infl_id = 34;
insert into constraints set constr_id = 'S', infl_id = 37;
insert into constraints set constr_id = 'S', infl_id = 38;

-- Singular (pronouns)
insert into constraints set constr_id = 'S', infl_id = 41;
insert into constraints set constr_id = 'S', infl_id = 42;
insert into constraints set constr_id = 'S', infl_id = 45;
insert into constraints set constr_id = 'S', infl_id = 46;

-- Plural (nouns)
insert into constraints set constr_id = 'P', infl_id = 3;
insert into constraints set constr_id = 'P', infl_id = 4;
insert into constraints set constr_id = 'P', infl_id = 7;
insert into constraints set constr_id = 'P', infl_id = 8;
insert into constraints set constr_id = 'P', infl_id = 11;
insert into constraints set constr_id = 'P', infl_id = 12;
insert into constraints set constr_id = 'P', infl_id = 15;
insert into constraints set constr_id = 'P', infl_id = 16;
insert into constraints set constr_id = 'P', infl_id = 19;
insert into constraints set constr_id = 'P', infl_id = 20;
insert into constraints set constr_id = 'P', infl_id = 23;
insert into constraints set constr_id = 'P', infl_id = 24;

-- Plural (adjectives)
insert into constraints set constr_id = 'P', infl_id = 27;
insert into constraints set constr_id = 'P', infl_id = 28;
insert into constraints set constr_id = 'P', infl_id = 31;
insert into constraints set constr_id = 'P', infl_id = 32;
insert into constraints set constr_id = 'P', infl_id = 35;
insert into constraints set constr_id = 'P', infl_id = 36;
insert into constraints set constr_id = 'P', infl_id = 39;
insert into constraints set constr_id = 'P', infl_id = 40;

-- Plural (pronouns)
insert into constraints set constr_id = 'P', infl_id = 43;
insert into constraints set constr_id = 'P', infl_id = 44;
insert into constraints set constr_id = 'P', infl_id = 47;
insert into constraints set constr_id = 'P', infl_id = 48;

-- Plural (verbs)
insert into constraints set constr_id = 'P', infl_id = 49;
insert into constraints set constr_id = 'P', infl_id = 50;
insert into constraints set constr_id = 'P', infl_id = 52;
insert into constraints set constr_id = 'P', infl_id = 53;
insert into constraints set constr_id = 'P', infl_id = 57;
insert into constraints set constr_id = 'P', infl_id = 58;
insert into constraints set constr_id = 'P', infl_id = 59;
insert into constraints set constr_id = 'P', infl_id = 63;
insert into constraints set constr_id = 'P', infl_id = 64;
insert into constraints set constr_id = 'P', infl_id = 65;
insert into constraints set constr_id = 'P', infl_id = 69;
insert into constraints set constr_id = 'P', infl_id = 70;
insert into constraints set constr_id = 'P', infl_id = 71;
insert into constraints set constr_id = 'P', infl_id = 75;
insert into constraints set constr_id = 'P', infl_id = 76;
insert into constraints set constr_id = 'P', infl_id = 77;
insert into constraints set constr_id = 'P', infl_id = 81;
insert into constraints set constr_id = 'P', infl_id = 82;
insert into constraints set constr_id = 'P', infl_id = 83;

-- Impersonal (verbs)
insert into constraints set constr_id = 'U', infl_id = 49;
insert into constraints set constr_id = 'U', infl_id = 50;
insert into constraints set constr_id = 'U', infl_id = 52;
insert into constraints set constr_id = 'U', infl_id = 53;
insert into constraints set constr_id = 'U', infl_id = 56;
insert into constraints set constr_id = 'U', infl_id = 59;
insert into constraints set constr_id = 'U', infl_id = 62;
insert into constraints set constr_id = 'U', infl_id = 65;
insert into constraints set constr_id = 'U', infl_id = 68;
insert into constraints set constr_id = 'U', infl_id = 71;
insert into constraints set constr_id = 'U', infl_id = 74;
insert into constraints set constr_id = 'U', infl_id = 77;
insert into constraints set constr_id = 'U', infl_id = 80;
insert into constraints set constr_id = 'U', infl_id = 83;

-- Unipersonal (verbs)
insert into constraints set constr_id = 'I', infl_id = 49;
insert into constraints set constr_id = 'I', infl_id = 50;
insert into constraints set constr_id = 'I', infl_id = 52;
insert into constraints set constr_id = 'I', infl_id = 53;
insert into constraints set constr_id = 'I', infl_id = 56;
insert into constraints set constr_id = 'I', infl_id = 62;
insert into constraints set constr_id = 'I', infl_id = 68;
insert into constraints set constr_id = 'I', infl_id = 74;
insert into constraints set constr_id = 'I', infl_id = 80;

-- Past tenses (verbs)
insert into constraints set constr_id = 'T', infl_id = 49;
insert into constraints set constr_id = 'T', infl_id = 50;
insert into constraints set constr_id = 'T', infl_id = 52;
insert into constraints set constr_id = 'T', infl_id = 53;

insert into constraints set constr_id = 'T', infl_id = 66;
insert into constraints set constr_id = 'T', infl_id = 67;
insert into constraints set constr_id = 'T', infl_id = 68;
insert into constraints set constr_id = 'T', infl_id = 69;
insert into constraints set constr_id = 'T', infl_id = 70;
insert into constraints set constr_id = 'T', infl_id = 71;

insert into constraints set constr_id = 'T', infl_id = 72;
insert into constraints set constr_id = 'T', infl_id = 73;
insert into constraints set constr_id = 'T', infl_id = 74;
insert into constraints set constr_id = 'T', infl_id = 75;
insert into constraints set constr_id = 'T', infl_id = 76;
insert into constraints set constr_id = 'T', infl_id = 77;

insert into constraints set constr_id = 'T', infl_id = 78;
insert into constraints set constr_id = 'T', infl_id = 79;
insert into constraints set constr_id = 'T', infl_id = 80;
insert into constraints set constr_id = 'T', infl_id = 81;
insert into constraints set constr_id = 'T', infl_id = 82;
insert into constraints set constr_id = 'T', infl_id = 83;

-- inflections
delete from inflections where infl_id >= 10000;
update inflections set infl_descr = "Verb, Infinitiv prezent"
  where infl_descr = "Verb, Infintiv prezent";
insert into inflections set infl_id = 84, infl_descr = 'Invariabil';

-- lexems
alter table lexems change lexem_id lexem_id int not null auto_increment,
  add lexem_neaccentuat char(50) not null after lexem_forma,
  add lexem_utf8_general char(50) not null collate utf8_general_ci after lexem_neaccentuat,
  add lexem_invers char(50) not null after lexem_utf8_general,
  add lexem_descr varchar(255) not null after lexem_invers,
  add lexem_comment varchar(255) not null,
  add lexem_is_loc int not null,
  add key(lexem_neaccentuat),
  add key(lexem_utf8_general),
  add key(lexem_invers),
  drop key `lex_restriction`;

update lexems set lexem_model_no = 1 where lexem_model_type = 'I';
update lexems set lexem_neaccentuat = replace(lexem_forma, "'", '');
update lexems set lexem_utf8_general = lexem_neaccentuat,
  lexem_invers = reverse(lexem_neaccentuat),
  lexem_is_loc = 1;
delete from lexems where lexem_forma = '1';

-- model_description
alter table model_description drop primary key,
  add md_id int not null auto_increment first,
  add primary key(md_id),
  add md_variant int not null after md_infl,
  add key(md_model),
  add md_accent_shift int not null;
update model_description set md_variant = floor(md_infl / 10000),
  md_infl = md_infl % 10000;
update model_description set md_transf = 1 where md_transf in (0, 546);

-- model_mappings
alter table model_mappings drop key `slave`,
  add unique key (model_type, slave_no);

-- model_types
drop table if exists model_types;
create table model_types (
  mt_id int not null auto_increment,
  mt_value char(2) not null,
  mt_descr varchar(255) not null,
  mt_canonical char(2) not null,
  primary key (mt_id),
  key (mt_value),
  key (mt_canonical)
);

insert into model_types set mt_value = 'I',
  mt_descr = 'Invariabil',
  mt_canonical = 'I';
insert into model_types set mt_value = 'M',
  mt_descr = 'Substantiv masculin',
  mt_canonical = 'M';
insert into model_types set mt_value = 'F',
  mt_descr = 'Substantiv feminin',
  mt_canonical = 'F';
insert into model_types set mt_value = 'N',
  mt_descr = 'Substantiv neutru',
  mt_canonical = 'N';
insert into model_types set mt_value = 'A',
  mt_descr = 'Adjectiv',
  mt_canonical = 'A';
insert into model_types set mt_value = 'MF',
  mt_descr = 'Substantiv masculin şi feminin',
  mt_canonical = 'A';
insert into model_types set mt_value = 'P',
  mt_descr = 'Pronume',
  mt_canonical = 'P';
insert into model_types set mt_value = 'V',
  mt_descr = 'Verb',
  mt_canonical = 'V';
insert into model_types set mt_value = 'VT',
  mt_descr = 'Verb tranzitiv',
  mt_canonical = 'V';
insert into model_types set mt_value = 'T',
  mt_descr = 'Temporar',
  mt_canonical = 'T';

-- participle_models
alter table participle_models drop primary key;
alter table participle_models add pm_id int not null auto_increment first,
  add primary key(pm_id), add key (pm_verb_model);

-- wordlist
alter table wordlist
  add wl_neaccentuat char(50) not null after wl_form,
  add wl_utf8_general char(50) not null collate utf8_general_ci after wl_neaccentuat,
  add wl_variant int not null,
  add key (wl_neaccentuat),
  add key (wl_utf8_general),
  add key (wl_variant);
update wordlist set wl_form = replace(wl_form, "é", "'e")
  where wl_lexem not like "champlevé%"
  and wl_lexem not like "cloisonné%"
  and wl_lexem not like "consommé%"
  and wl_lexem not like "maché%";
update wordlist set wl_form = replace(wl_form, "ú", "'u");
update wordlist set wl_form = replace(wl_form, "ó", "'o");
update wordlist set wl_form = replace(wl_form, "ắ", "'ă");
update wordlist set wl_neaccentuat = replace(wl_form, "'", '');
update wordlist set wl_variant = floor(wl_analyse / 10000),
  wl_analyse = wl_analyse % 10000,
  wl_utf8_general = wl_neaccentuat;
update wordlist set wl_analyse = 84 where wl_analyse = 0;
delete from wordlist where wl_form like '1%';

-- model_exponents;
alter table model_exponents add flag int not null;
alter table model_exponents drop key `lexem_model`;
alter table model_exponents add unique key model (model_type, model_no);

insert into model_exponents set model_type = 'I', model_no = '1',
  form = 'invariabil';
insert into model_exponents set model_type = 'T', model_no = '1',
  form = 'invariabil';

insert into model_exponents set model_type = 'V', model_no = '2',
  form = 'circula';
insert into model_exponents set model_type = 'V', model_no = '6',
  form = 'merita';
insert into model_exponents set model_type = 'V', model_no = '7',
  form = 'aplauda';
insert into model_exponents set model_type = 'V', model_no = '9',
  form = 'amâna';
insert into model_exponents set model_type = 'V', model_no = '14',
  form = 'critica';
insert into model_exponents set model_type = 'V', model_no = '15',
  form = 'fumega';
insert into model_exponents set model_type = 'V', model_no = '19',
  form = 'clătina';
insert into model_exponents set model_type = 'V', model_no = '73',
  form = 'încăleca';
insert into model_exponents set model_type = 'V', model_no = '74',
  form = 'adăuga';
insert into model_exponents set model_type = 'V', model_no = '103',
  form = 'apropia';
insert into model_exponents set model_type = 'V', model_no = '105',
  form = 'mângâia';
insert into model_exponents set model_type = 'V', model_no = '510',
  form = 'prevedea';
insert into model_exponents set model_type = 'V', model_no = '606',
  form = 'abate';
insert into model_exponents set model_type = 'V', model_no = '643',
  form = 'conduce';
insert into model_exponents set model_type = 'V', model_no = '644',
  form = 'zice';
insert into model_exponents set model_type = 'V', model_no = '648',
  form = 'readuce';

-- LexemDefinitionMap
drop table if exists LexemDefinitionMap;
create table LexemDefinitionMap (
  Id int not null auto_increment,
  LexemId int not null,
  DefinitionId int not null,
  unique key (Id),
  key (LexemId),
  key (DefinitionId)
);

-- transforms
update transforms set transf_to = '' where transf_to = '-';

-- dmlr_models
alter table dmlr_models add variant int not null after infl_id;
delete from dmlr_models where model_type = 'V' and model_no = '666'
  and infl_id > 100 and infl_id != 10056 and infl_id != 10062
  and infl_id != 10065;
update dmlr_models set form = replace(form, "ắ", "'ă");
update dmlr_models set form = replace(form, "é", "'e");
update dmlr_models set form = replace(form, "ó", "'o");
update dmlr_models set form = replace(form, "ú", "'u");
update dmlr_models set variant = floor(infl_id / 10000),
  infl_id = infl_id % 10000;

-- Create invariable and temporary models
insert into models set model_id = 770, model_type = 'I', model_no = '1';
insert into models set model_id = 771, model_type = 'T', model_no = '1';

insert into model_description set md_model = 770, md_infl = 84, md_variant = 0,
  md_order = 0, md_transf = 1, md_accent_shift = 0;
insert into model_description set md_model = 771, md_infl = 84, md_variant = 0,
  md_order = 0, md_transf = 1, md_accent_shift = 0;
